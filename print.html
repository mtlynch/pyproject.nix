<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pyproject.nix</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">1.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="HACKING.html"><strong aria-hidden="true">2.</strong> Hacking</a></li><li class="chapter-item expanded "><a href="FAQ.html"><strong aria-hidden="true">3.</strong> FAQ</a></li><li class="chapter-item expanded affix "><li class="part-title">Use cases</li><li class="chapter-item expanded "><a href="use-cases/requirements.html"><strong aria-hidden="true">4.</strong> requirements.txt</a></li><li class="chapter-item expanded "><a href="use-cases/pyproject.html"><strong aria-hidden="true">5.</strong> pyproject.toml</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference</li><li class="chapter-item expanded "><a href="reference.html"><strong aria-hidden="true">6.</strong> User facing APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lib/project.html"><strong aria-hidden="true">6.1.</strong> project</a></li><li class="chapter-item expanded "><a href="lib/renderers.html"><strong aria-hidden="true">6.2.</strong> renderers</a></li><li class="chapter-item expanded "><a href="lib/validators.html"><strong aria-hidden="true">6.3.</strong> validators</a></li><li class="chapter-item expanded "><a href="fetchers/default.html"><strong aria-hidden="true">6.4.</strong> fetchers</a></li></ol></li><li class="chapter-item expanded "><a href="reference.html"><strong aria-hidden="true">7.</strong> Standards APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lib/pep440.html"><strong aria-hidden="true">7.1.</strong> pep440</a></li><li class="chapter-item expanded "><a href="lib/pep508.html"><strong aria-hidden="true">7.2.</strong> pep508</a></li><li class="chapter-item expanded "><a href="lib/pep518.html"><strong aria-hidden="true">7.3.</strong> pep518</a></li><li class="chapter-item expanded "><a href="lib/pep599.html"><strong aria-hidden="true">7.4.</strong> pep599</a></li><li class="chapter-item expanded "><a href="lib/pep600.html"><strong aria-hidden="true">7.5.</strong> pep600</a></li><li class="chapter-item expanded "><a href="lib/pep621.html"><strong aria-hidden="true">7.6.</strong> pep621</a></li><li class="chapter-item expanded "><a href="lib/poetry.html"><strong aria-hidden="true">7.7.</strong> poetry</a></li><li class="chapter-item expanded "><a href="lib/pypa.html"><strong aria-hidden="true">7.8.</strong> pypa</a></li><li class="chapter-item expanded "><a href="lib/pip.html"><strong aria-hidden="true">7.9.</strong> pip</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Pyproject.nix</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/nix-community/pyproject.nix" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h1>
<h2 id="foreword"><a class="header" href="#foreword">Foreword</a></h2>
<p>This documentation only helps you to get started with <code>pyproject.nix</code>.
As it's a toolkit with many use cases not every use case can be documented fully.</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<h3 id="flakes"><a class="header" href="#flakes">Flakes</a></h3>
<p><a href="https://nix.dev/concepts/flakes">Nix Flakes</a> has many different opinionated ways to manage it's outputs.
This is the a minimal example of a Flake containing a pyproject.nix installation to show you the essence of how to install pyproject.nix.</p>
<pre><code class="language-nix">{
  inputs.pyproject.url = &quot;github:nix-community/pyproject.nix&quot;;
  inputs.pyproject.inputs.nixpkgs.follows = &quot;nixpkgs&quot;;

  outputs = { self, nixpkgs, pyproject }: let
    inherit (nixpkgs) lib;

    # Loads pyproject.toml into a high-level project representation
    # Do you notice how this is not tied to any `system` attribute or package sets?
    # That is because `project` refers to a pure data representation.
    project = pyproject.lib.project.loadPyproject {
      # Read &amp; unmarshal pyproject.toml
      pyproject = lib.importTOML ./pyproject.toml;
    };

    # This example is only using x86_64-linux
    pkgs = nixpkgs.legacyPackages.x86_64-linux;

    # We are using the default Python3 interpreter &amp; package set
    python = pkgs.python3;

  in {

    # Create a development shell containing dependencies from `pyproject.toml`
    devShells.x86_64-linux.default = let
      # Returns a function that can be passed to `python.withPackages`
      arg = pyproject.lib.renderers.withPackages { inherit python project; };

      # Returns a wrapped environment (virtualenv like) with all our packages
      pythonEnv = python.withPackages arg;

    in pkgs.mkShell {
      packages = [ pythonEnv ];
    };

    # Build our package using `buildPythonPackage
    packages.x86_64-linux.default = let
      # Returns an attribute set that can be passed to `buildPythonPackage`.
      attrs = pyproject.lib.renderers.buildPythonPackage { inherit python project; };
    in python.pkgs.buildPythonPackage attrs;
  };
}
</code></pre>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/doc/src/getting-started.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="hacking"><a class="header" href="#hacking">Hacking</a></h1>
<p>This document outlines hacking on <code>pyproject.nix</code> itself, and lays out it's project structure.</p>
<h2 id="getting-started-1"><a class="header" href="#getting-started-1">Getting started</a></h2>
<p>To start hacking run <code>nix develop -c run</code> to run the project in watch mode.</p>
<p>This will start up two processes:</p>
<ul>
<li>A <a href="https://github.com/adisbladis/nix-unit">Nix-unit</a> test runner</li>
<li>A <a href="https://rust-lang.github.io/mdBook/">documentation server</a> available at http://localhost:3000</li>
</ul>
<h2 id="project-structure--testing"><a class="header" href="#project-structure--testing">Project structure &amp; testing</a></h2>
<p>All Nix code lives in <code>lib/</code>. Each file has an implementation and a test suite.
The attribute path to a an attribute <code>parseVersion</code> in <code>lib/pep440.nix</code> would be <code>lib.pep440.parseVersion</code>.</p>
<p>A function in <code>lib/test.nix</code> maps over the public interface of the library and the test suite to generate coverage tests, ensuring that every exported symbol has at least one test covering it.</p>
<p>Integration tests meaning tests that perform environment constructions &amp; builds lives in <code>test/</code> and are exposed through Flake checks.</p>
<p>The manual you are reading right now is built from the <code>doc/</code> directory.
To edit a specific page see the &quot;Edit this page on GitHub&quot; link in the footer for each respective page.</p>
<h2 id="running-tests"><a class="header" href="#running-tests">Running tests</a></h2>
<ul>
<li>
<p>Run the entire unit test suite
<code>$ nix-unit --flake .#libTests</code></p>
</li>
<li>
<p>Run unit tests for an individual function
<code>$ nix-unit --flake .#libTests.pep440.parseVersion</code></p>
</li>
<li>
<p>Run integration tests
<code>$ nix flake check</code></p>
</li>
</ul>
<h2 id="formatter"><a class="header" href="#formatter">Formatter</a></h2>
<p>Before submitting a PR format the code with <code>nix fmt</code> and ensure Flake checks pass with <code>nix flake check</code>.</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/doc/src/HACKING.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="faq"><a class="header" href="#faq">FAQ</a></h1>
<h2 id="how-does-package-name-mapping-from-python-to-nixpkgs-work"><a class="header" href="#how-does-package-name-mapping-from-python-to-nixpkgs-work">How does package name mapping from Python to Nixpkgs work?</a></h2>
<p>Package names are normalized according to the <a href="https://packaging.python.org/en/latest/specifications/name-normalization/#normalization">PyPA normalization specification</a>.
Nixpkgs also uses the same normalization <a href="https://github.com/NixOS/nixpkgs/issues/245383">but has some legacy package names</a> that do not follow normalization guidelines.</p>
<h2 id="how-do-you-treat-dynamic-attributes"><a class="header" href="#how-do-you-treat-dynamic-attributes">How do you treat <code>dynamic</code> attributes?</a></h2>
<p>Pyproject.nix makes no attempt at parsing dynamic fields as it does not have the required knowledge to infer these.</p>
<p>When using the <code>withPackages</code> renderer most fields that may be dynamic are not even relevant and won't cause issues.
At other times, like when using the <code>buildPythonPackage</code> renderer problems occur as there is no way for the renderer to create the version attribute.</p>
<pre><code class="language-nix">let
  project = pyproject.project.loadPyproject { pyproject = lib.importTOML ./pyproject.toml; };
  python = pkgs.python3;
  attrs = pyproject.renderers.buildPythonPackage { inherit python project; };
in python.pkgs.buildPythonPackage attrs
</code></pre>
<p>Will result in an error from <code>buildPythonpackage</code> because <code>version</code> is missing:</p>
<pre><code>error: attribute 'version' missing

at /nix/store/gna8i238i3nnz6cizcayyfyfdzn28la5-nixpkgs/pkgs/development/interpreters/python/mk-python-derivation.nix:31:28:

    30|
    31| { name ? &quot;${attrs.pname}-${attrs.version}&quot;
      |                            ^
    32|
</code></pre>
<p>In these cases you can manually add attributes to the attribute set returned by the renderer:</p>
<pre><code class="language-nix">let
  project = pyproject.project.loadPyproject { pyproject = lib.importTOML ./pyproject.toml; };
  python = pkgs.python3;
  attrs = pyproject.renderers.buildPythonPackage { inherit python project; };
in python.pkgs.buildPythonPackage (attrs // {
  version = &quot;1.0&quot;;  # Not dynamically inferred
})
</code></pre>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/doc/src/FAQ.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="requirementstxt"><a class="header" href="#requirementstxt">requirements.txt</a></h1>
<p>Many projects comes without proper packaging and use <a href="https://pip.pypa.io/en/stable/reference/requirements-file-format/"><code>requirements.txt</code></a> files to declare their dependencies.</p>
<p>This example loads <code>requirements.txt</code> to create an environment using <a href="https://nixos.org/manual/nixpkgs/stable/#user-guide"><code>python.withPackages</code></a> with packages from nixpkgs.</p>
<h2 id="flakenix"><a class="header" href="#flakenix">flake.nix</a></h2>
<pre><code class="language-nix">{
  description = &quot;Construct development shell from requirements.txt&quot;;

  inputs.nixpkgs.url = &quot;github:NixOS/nixpkgs/nixpkgs-unstable&quot;;
  inputs.flake-utils.url = &quot;github:numtide/flake-utils&quot;;

  inputs.pyproject-nix.url = &quot;github:nix-community/pyproject.nix&quot;;
  inputs.pyproject-nix.flake = false; # Don't use the pyproject.nix flake directly to avoid it's inputs in our closure

  outputs =
    { nixpkgs
    , flake-utils
    , pyproject-nix
    }:
    let
      pyproject = import (pyproject-nix + &quot;/lib&quot;) { inherit (nixpkgs) lib; };

      # Load/parse requirements.txt
      project = pyproject.project.loadRequirementsTxt {
        requirements = ./requirements.txt;
      };

    in
    flake-utils.lib.eachDefaultSystem (system:
    let
      pkgs = nixpkgs.legacyPackages.${system};
      python = pkgs.python3;

      pythonEnv =
        # Assert that versions from nixpkgs matches what's described in requirements.txt
        # In projects that are overly strict about pinning it might be best to remove this assertion entirely.
        assert pyproject.validators.validateVersionConstraints { inherit project python; } == { }; (
          # Render requirements.txt into a Python withPackages environment
          pkgs.python3.withPackages (pyproject.renderers.withPackages {
            inherit project python;
          })
        );

    in
    {
      devShell =
        pkgs.mkShell {
          packages = [
            pythonEnv
          ];
        };
    });
}
</code></pre>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/doc/src/use-cases/requirements.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="pyprojecttoml"><a class="header" href="#pyprojecttoml">pyproject.toml</a></h1>
<p>It's possible to develop <a href="https://peps.python.org/pep-0621/">PEP-621</a> compliant Python projects without using <em>any</em> Python package manager except Nix.</p>
<p>This example loads <code>pyproject.toml</code> to create an environment using <a href="https://nixos.org/manual/nixpkgs/stable/#user-guide"><code>python.withPackages</code></a> and a consumable package using <code>python.pkgs.buildPythonPackage</code>.</p>
<h2 id="flakenix-1"><a class="header" href="#flakenix-1">flake.nix</a></h2>
<pre><code class="language-nix">{
  description = &quot;A basic flake using pyproject.toml project metadata&quot;;

  inputs.pyproject.url = &quot;github:nix-community/pyproject.nix&quot;;
  inputs.pyproject.inputs.nixpkgs.follows = &quot;nixpkgs&quot;;

  outputs = { nixpkgs, pyproject }:
    let
      inherit (nixpkgs) lib;

      # Loads pyproject.toml into a high-level project representation
      # Do you notice how this is not tied to any `system` attribute or package sets?
      # That is because `project` refers to a pure data representation.
      project = pyproject.lib.project.loadPyproject {
        # Read &amp; unmarshal pyproject.toml
        pyproject = lib.importTOML ./pyproject.toml;
      };

      # This example is only using x86_64-linux
      pkgs = nixpkgs.legacyPackages.x86_64-linux;

      # We are using the default Python3 interpreter &amp; package set
      python = pkgs.python3;

    in
    {

      # Create a development shell containing dependencies from `pyproject.toml`
      devShells.x86_64-linux.default =
        let
          # Returns a function that can be passed to `python.withPackages`
          arg = pyproject.lib.renderers.withPackages { inherit python project; };

          # Returns a wrapped environment (virtualenv like) with all our packages
          pythonEnv = python.withPackages arg;

        in
        pkgs.mkShell {
          packages = [ pythonEnv ];
        };

      # Build our package using `buildPythonPackage
      packages.x86_64-linux.default =
        let
          # Returns an attribute set that can be passed to `buildPythonPackage`.
          attrs = pyproject.lib.renderers.buildPythonPackage { inherit python project; };
        in
        python.pkgs.buildPythonPackage attrs;
    };
}
</code></pre>
<h2 id="pyprojecttoml-1"><a class="header" href="#pyprojecttoml-1">pyproject.toml</a></h2>
<pre><code class="language-toml">[project]
name = &quot;spam&quot;
version = &quot;2020.0.0&quot;
description = &quot;Lovely Spam! Wonderful Spam!&quot;
readme = &quot;README.rst&quot;
requires-python = &quot;&gt;=3.8&quot;
license = {file = &quot;LICENSE.txt&quot;}
keywords = [&quot;egg&quot;, &quot;bacon&quot;, &quot;sausage&quot;, &quot;tomatoes&quot;, &quot;Lobster Thermidor&quot;]
authors = [
  {email = &quot;hi@pradyunsg.me&quot;},
  {name = &quot;Tzu-ping Chung&quot;}
]
maintainers = [
  {name = &quot;Brett Cannon&quot;, email = &quot;brett@python.org&quot;}
]
classifiers = [
  &quot;Development Status :: 4 - Beta&quot;,
  &quot;Programming Language :: Python&quot;
]

dependencies = [
  &quot;httpx&quot;,
  &quot;gidgethub[httpx]&gt;4.0.0&quot;,
  &quot;django&gt;2.1; os_name != 'nt'&quot;,
  &quot;django&gt;2.0; os_name == 'nt'&quot;
]

[project.optional-dependencies]
test = [
  &quot;pytest &lt; 5.0.0&quot;,
  &quot;pytest-cov[all]&quot;
]

[project.urls]
homepage = &quot;https://example.com&quot;
documentation = &quot;https://readthedocs.org&quot;
repository = &quot;https://github.com&quot;
changelog = &quot;https://github.com/me/spam/blob/master/CHANGELOG.md&quot;

[project.scripts]
spam-cli = &quot;spam:main_cli&quot;

[project.gui-scripts]
spam-gui = &quot;spam:main_gui&quot;

[project.entry-points.&quot;spam.magical&quot;]
tomatoes = &quot;spam:main_tomatoes&quot;
</code></pre>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/doc/src/use-cases/pyproject.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="reference-documentation"><a class="header" href="#reference-documentation">Reference documentation</a></h1>
<p>The reference documentation is split up into two main categories:</p>
<ul>
<li>User facing APIs</li>
</ul>
<p>Contains high-level representations and has notions of things like a <code>project</code> (a fully parsed <code>pyproject.toml</code>) and further operations done on the project level.</p>
<ul>
<li>Standards APIs</li>
</ul>
<p>Contains parsers, evaluators &amp; utility functions for dealing with Python packaging standards defined by the through the PEP process &amp; from PyPA.</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/doc/src/reference.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-project"><a class="header" href="#sec-functions-library-project">project</a></h1>
<h2 id="function-library-lib.project.loadPyproject"><a class="header" href="#function-library-lib.project.loadPyproject"><code>lib.project.loadPyproject</code></a></h2>
<p><strong>Type</strong>: <code>loadPyproject :: AttrSet -&gt; AttrSet</code></p>
<p>Load dependencies from a pyproject.toml.</p>
<p>structured function argument</p>
<p>: <code>pyproject</code></p>
<p>: The unmarshaled contents of pyproject.toml</p>
<p><code>extrasAttrPaths</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.project.loadPyproject}</p>
<h1 id="libprojectloadpyproject-usage-example"><a class="header" href="#libprojectloadpyproject-usage-example"><code>lib.project.loadPyproject</code> usage example</a></h1>
<pre><code class="language-nix"># loadPyproject { pyproject = lib.importTOML }
{
  dependencies = { }; # Parsed dependency structure in the schema of `lib.pep621.parseDependencies`
  build-systems = [ ];  # Returned by `lib.pep518.parseBuildSystems`
  pyproject = { }; # The unmarshaled contents of pyproject.toml
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.project.loadPoetryPyproject"><a class="header" href="#function-library-lib.project.loadPoetryPyproject"><code>lib.project.loadPoetryPyproject</code></a></h2>
<p><strong>Type</strong>: <code>loadPoetryPyproject :: AttrSet -&gt; AttrSet</code></p>
<p>Load dependencies from a Poetry pyproject.toml.</p>
<p>structured function argument</p>
<p>: <code>pyproject</code></p>
<p>: The unmarshaled contents of pyproject.toml</p>
<p>::: {.example #function-library-example-lib.project.loadPoetryPyproject}</p>
<h1 id="libprojectloadpoetrypyproject-usage-example"><a class="header" href="#libprojectloadpoetrypyproject-usage-example"><code>lib.project.loadPoetryPyproject</code> usage example</a></h1>
<pre><code class="language-nix"># loadPoetryPyproject { pyproject = lib.importTOML }
{
  dependencies = { }; # Parsed dependency structure in the schema of `lib.pep621.parseDependencies`
  build-systems = [ ];  # Returned by `lib.pep518.parseBuildSystems`
  pyproject = { }; # The unmarshaled contents of pyproject.toml
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.project.loadRequirementsTxt"><a class="header" href="#function-library-lib.project.loadRequirementsTxt"><code>lib.project.loadRequirementsTxt</code></a></h2>
<p><strong>Type</strong>: <code>loadRequirementsTxt :: AttrSet -&gt; AttrSet</code></p>
<p>Load dependencies from a requirements.txt.</p>
<p>Note that as requirements.txt is lacking important project metadata this is incompatible with some renderers.</p>
<p>structured function argument</p>
<p>: <code>requirements</code></p>
<p>: The contents of requirements.txt</p>
<p>::: {.example #function-library-example-lib.project.loadRequirementsTxt}</p>
<h1 id="libprojectloadrequirementstxt-usage-example"><a class="header" href="#libprojectloadrequirementstxt-usage-example"><code>lib.project.loadRequirementsTxt</code> usage example</a></h1>
<pre><code class="language-nix"># loadRequirementstxt { requirements = builtins.readFile ./requirements.txt; root = ./.; }
{
  dependencies = { }; # Parsed dependency structure in the schema of `lib.pep621.parseDependencies`
  build-systems = [ ];  # Returned by `lib.pep518.parseBuildSystems`
  pyproject = null; # The unmarshaled contents of pyproject.toml
}
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/project.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-renderers"><a class="header" href="#sec-functions-library-renderers">renderers</a></h1>
<h2 id="function-library-lib.renderers.withPackages"><a class="header" href="#function-library-lib.renderers.withPackages"><code>lib.renderers.withPackages</code></a></h2>
<p><strong>Type</strong>: <code>withPackages :: AttrSet -&gt; lambda</code></p>
<p>Renders a project as an argument that can be passed to withPackages</p>
<p>Evaluates PEP-508 environment markers to select correct dependencies for the platform but does not validate version constraints.
For validation see <code>lib.validators</code>.</p>
<p>structured function argument</p>
<p>: <code>project</code></p>
<p>: Project metadata as returned by <code>lib.project.loadPyproject</code></p>
<p><code>python</code></p>
<p>: Python derivation</p>
<p><code>extras</code></p>
<p>: Python extras (optionals) to enable</p>
<p>::: {.example #function-library-example-lib.renderers.withPackages}</p>
<h1 id="librendererswithpackages-usage-example"><a class="header" href="#librendererswithpackages-usage-example"><code>lib.renderers.withPackages</code> usage example</a></h1>
<pre><code class="language-nix"># withPackages (lib.project.loadPyproject { ... })
  «lambda @ «string»:1:1»
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.renderers.buildPythonPackage"><a class="header" href="#function-library-lib.renderers.buildPythonPackage"><code>lib.renderers.buildPythonPackage</code></a></h2>
<p><strong>Type</strong>: <code>buildPythonPackage :: AttrSet -&gt; AttrSet</code></p>
<p>Renders a project as an argument that can be passed to buildPythonPackage/buildPythonApplication.</p>
<p>Evaluates PEP-508 environment markers to select correct dependencies for the platform but does not validate version constraints.
For validation see <code>lib.validators</code>.</p>
<p>structured function argument</p>
<p>: <code>project</code></p>
<p>: Project metadata as returned by <code>lib.project.loadPyproject</code></p>
<p><code>python</code></p>
<p>: Python derivation</p>
<p><code>extras</code></p>
<p>: Python extras (optionals) to enable</p>
<p><code>extrasAttrMappings</code></p>
<p>: Map a Python extras group name to a Nix attribute set. This is intended to be used with optionals such as test dependencies that you might want to add to checkInputs instead of propagatedBuildInputs</p>
<p><code>format</code></p>
<p>: Which package format to pass to buildPythonPackage If the format is &quot;wheel&quot; PEP-518 build-systems are excluded from the build.</p>
<p>::: {.example #function-library-example-lib.renderers.buildPythonPackage}</p>
<h1 id="librenderersbuildpythonpackage-usage-example"><a class="header" href="#librenderersbuildpythonpackage-usage-example"><code>lib.renderers.buildPythonPackage</code> usage example</a></h1>
<pre><code class="language-nix"># buildPythonPackage { project = lib.project.loadPyproject ...; python = pkgs.python3;  }
  { pname = &quot;blinker&quot;; version = &quot;1.3.3.7&quot;; propagatedBuildInputs = [ ]; }
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/renderers.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-validators"><a class="header" href="#sec-functions-library-validators">validators</a></h1>
<h2 id="function-library-lib.validators.validateVersionConstraints"><a class="header" href="#function-library-lib.validators.validateVersionConstraints"><code>lib.validators.validateVersionConstraints</code></a></h2>
<p><strong>Type</strong>: <code>validateVersionConstraints :: AttrSet -&gt; AttrSet</code></p>
<p>Validates the Python package set held by Python (<code>python.pkgs</code>) against the parsed project.</p>
<p>Returns an attribute set where the name is the Python package derivation <code>pname</code> and the value is a list of the mismatching conditions.</p>
<p>structured function argument</p>
<p>: <code>project</code></p>
<p>: Project metadata as returned by <code>lib.project.loadPyproject</code></p>
<p><code>python</code></p>
<p>: Python derivation</p>
<p><code>extras</code></p>
<p>: Python extras (optionals) to enable</p>
<p>::: {.example #function-library-example-lib.validators.validateVersionConstraints}</p>
<h1 id="libvalidatorsvalidateversionconstraints-usage-example"><a class="header" href="#libvalidatorsvalidateversionconstraints-usage-example"><code>lib.validators.validateVersionConstraints</code> usage example</a></h1>
<pre><code class="language-nix"># validateVersionConstraints (lib.project.loadPyproject { ... })
{
  resolvelib = {
    # conditions as returned by `lib.pep440.parseVersionCond`
    conditions = [ { op = &quot;&gt;=&quot;; version = { dev = null; epoch = 0; local = null; post = null; pre = null; release = [ 1 0 1 ]; }; } ];
    # Version from Python package set
    version = &quot;0.5.5&quot;;
  };
  unearth = {
    conditions = [ { op = &quot;&gt;=&quot;; version = { dev = null; epoch = 0; local = null; post = null; pre = null; release = [ 0 10 0 ]; }; } ];
    version = &quot;0.9.1&quot;;
  };
}
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/validators.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-fetchers"><a class="header" href="#sec-functions-library-fetchers">fetchers</a></h1>
<h2 id="function-library-lib.fetchers.fetchFromPypi"><a class="header" href="#function-library-lib.fetchers.fetchFromPypi"><code>lib.fetchers.fetchFromPypi</code></a></h2>
<p><strong>Type</strong>: <code>fetchFromPypi :: AttrSet -&gt; derivation</code></p>
<p>Fetch from the PyPI index.</p>
<p>At first we try to fetch the predicated URL but if that fails we
will use the Pypi API to determine the correct URL.</p>
<p>structured function argument</p>
<p>: <code>pname</code></p>
<p>: package name</p>
<p><code>file</code></p>
<p>: filename including extension</p>
<p><code>version</code></p>
<p>: the version string of the dependency</p>
<p><code>hash</code></p>
<p>: SRI hash</p>
<p><code>kind</code></p>
<p>: Language implementation and version tag</p>
<p><code>curlOpts</code></p>
<p>: Options to pass to <code>curl</code></p>
<h2 id="function-library-lib.fetchers.fetchFromLegacy"><a class="header" href="#function-library-lib.fetchers.fetchFromLegacy"><code>lib.fetchers.fetchFromLegacy</code></a></h2>
<p><strong>Type</strong>: <code>fetchFromLegacy :: AttrSet -&gt; derivation</code></p>
<p>Fetch from the PyPI legacy API.</p>
<p>Some repositories (such as Devpi) expose the Pypi legacy API (https://warehouse.pypa.io/api-reference/legacy.html).</p>
<p>structured function argument</p>
<p>: <code>pname</code></p>
<p>: package name</p>
<p><code>url</code></p>
<p>: URL to package index</p>
<p><code>file</code></p>
<p>: filename including extension</p>
<p><code>hash</code></p>
<p>: SRI hash</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/fetchers/default.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="reference-documentation-1"><a class="header" href="#reference-documentation-1">Reference documentation</a></h1>
<p>The reference documentation is split up into two main categories:</p>
<ul>
<li>User facing APIs</li>
</ul>
<p>Contains high-level representations and has notions of things like a <code>project</code> (a fully parsed <code>pyproject.toml</code>) and further operations done on the project level.</p>
<ul>
<li>Standards APIs</li>
</ul>
<p>Contains parsers, evaluators &amp; utility functions for dealing with Python packaging standards defined by the through the PEP process &amp; from PyPA.</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/doc/src/reference.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-pep440"><a class="header" href="#sec-functions-library-pep440">pep440</a></h1>
<h2 id="function-library-lib.pep440.parseVersion"><a class="header" href="#function-library-lib.pep440.parseVersion"><code>lib.pep440.parseVersion</code></a></h2>
<p><strong>Type</strong>: <code>parseVersion :: string -&gt; AttrSet</code></p>
<p>Parse a version according to PEP-440.</p>
<p><code>version</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep440.parseVersion}</p>
<h1 id="libpep440parseversion-usage-example"><a class="header" href="#libpep440parseversion-usage-example"><code>lib.pep440.parseVersion</code> usage example</a></h1>
<pre><code class="language-nix"># parseVersion &quot;3.0.0rc1&quot;
{
  dev = null;
  epoch = 0;
  local = null;
  post = null;
  pre = {
    type = &quot;rc&quot;;
    value = 1;
  };
  release = [ 3 0 0 ];
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep440.parseVersionCond"><a class="header" href="#function-library-lib.pep440.parseVersionCond"><code>lib.pep440.parseVersionCond</code></a></h2>
<p><strong>Type</strong>: <code>parseVersionCond :: string -&gt; AttrSet</code></p>
<p>Parse a version conditional.</p>
<p><code>cond</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep440.parseVersionCond}</p>
<h1 id="libpep440parseversioncond-usage-example"><a class="header" href="#libpep440parseversioncond-usage-example"><code>lib.pep440.parseVersionCond</code> usage example</a></h1>
<pre><code class="language-nix"># parseVersionCond &quot;&gt;=3.0.0rc1&quot;
{
  op = &quot;&gt;=&quot;;
  version = {
    dev = null;
    epoch = 0;
    local = null;
    post = null;
    pre = {
      type = &quot;rc&quot;;
      value = 1;
    };
    release = [ 3 0 0 ];
  };
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep440.compareVersions"><a class="header" href="#function-library-lib.pep440.compareVersions"><code>lib.pep440.compareVersions</code></a></h2>
<p><strong>Type</strong>: <code>compareVersions :: AttrSet -&gt; AttrSet -&gt; int</code></p>
<p>Compare two versions as parsed by <code>parseVersion</code> according to PEP-440.</p>
<p>Returns:</p>
<ul>
<li>-1 for less than</li>
<li>0 for equality</li>
<li>1 for greater than</li>
</ul>
<p><code>a</code></p>
<p>: Function argument</p>
<p><code>b</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep440.compareVersions}</p>
<h1 id="libpep440compareversions-usage-example"><a class="header" href="#libpep440compareversions-usage-example"><code>lib.pep440.compareVersions</code> usage example</a></h1>
<pre><code class="language-nix"># compareVersions (parseVersion &quot;3.0.0&quot;) (parseVersion &quot;3.0.0&quot;)
0
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep440.comparators"><a class="header" href="#function-library-lib.pep440.comparators"><code>lib.pep440.comparators</code></a></h2>
<p><strong>Type</strong>: <code>operators.${operator} :: AttrSet -&gt; AttrSet -&gt; bool</code></p>
<p>Map comparison operators as strings to a comparator function.</p>
<p>Attributes:</p>
<ul>
<li><a href="https://peps.python.org/pep-0440/#compatible-release">Compatible release clause</a>: <code>~=</code></li>
<li><a href="https://peps.python.org/pep-0440/#version-matching">Version matching clause</a>: <code>==</code></li>
<li><a href="https://peps.python.org/pep-0440/#version-exclusion">Version exclusion clause</a>: <code>!=</code></li>
<li><a href="https://peps.python.org/pep-0440/#inclusive-ordered-comparison">Inclusive ordered comparison clause</a>: <code>&lt;=</code>, <code>&gt;=</code></li>
<li><a href="https://peps.python.org/pep-0440/#exclusive-ordered-comparison">Exclusive ordered comparison clause</a>: <code>&lt;</code>, <code>&gt;</code></li>
<li><a href="https://peps.python.org/pep-0440/#arbitrary-equality">Arbitrary equality clause</a>: <code>===</code></li>
</ul>
<p>::: {.example #function-library-example-lib.pep440.comparators}</p>
<h1 id="libpep440comparators-usage-example"><a class="header" href="#libpep440comparators-usage-example"><code>lib.pep440.comparators</code> usage example</a></h1>
<pre><code class="language-nix"># comparators.&quot;==&quot; (parseVersion &quot;3.0.0&quot;) (parseVersion &quot;3.0.0&quot;)
true
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/pep440.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-pep508"><a class="header" href="#sec-functions-library-pep508">pep508</a></h1>
<h2 id="function-library-lib.pep508.parseMarkers"><a class="header" href="#function-library-lib.pep508.parseMarkers"><code>lib.pep508.parseMarkers</code></a></h2>
<p><strong>Type</strong>: <code>parseMarkers :: string -&gt; AttrSet</code></p>
<p>Parse PEP 508 markers into an AST.</p>
<p><code>input</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep508.parseMarkers}</p>
<h1 id="libpep508parsemarkers-usage-example"><a class="header" href="#libpep508parsemarkers-usage-example"><code>lib.pep508.parseMarkers</code> usage example</a></h1>
<pre><code class="language-nix"># parseMarkers &quot;(os_name=='a' or os_name=='b') and os_name=='c'&quot;
{
  lhs = {
    lhs = {
      lhs = {
        type = &quot;variable&quot;;
        value = &quot;os_name&quot;;
      };
      op = &quot;==&quot;;
      rhs = {
        type = &quot;string&quot;;
        value = &quot;a&quot;;
      };
      type = &quot;compare&quot;;
    };
    op = &quot;or&quot;;
    rhs = {
      lhs = {
        type = &quot;variable&quot;;
        value = &quot;os_name&quot;;
      };
      op = &quot;==&quot;;
      rhs = {
        type = &quot;string&quot;;
        value = &quot;b&quot;;
      };
      type = &quot;compare&quot;;
    };
    type = &quot;boolOp&quot;;
  };
  op = &quot;and&quot;;
  rhs = {
    lhs = {
      type = &quot;variable&quot;;
      value = &quot;os_name&quot;;
    };
    op = &quot;==&quot;;
    rhs = {
      type = &quot;string&quot;;
      value = &quot;c&quot;;
    };
    type = &quot;compare&quot;;
  };
  type = &quot;boolOp&quot;;
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep508.parseString"><a class="header" href="#function-library-lib.pep508.parseString"><code>lib.pep508.parseString</code></a></h2>
<p><strong>Type</strong>: <code>parseString :: string -&gt; AttrSet</code></p>
<p>Parse a PEP-508 dependency string.</p>
<p><code>input</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep508.parseString}</p>
<h1 id="libpep508parsestring-usage-example"><a class="header" href="#libpep508parsestring-usage-example"><code>lib.pep508.parseString</code> usage example</a></h1>
<pre><code class="language-nix"># parseString &quot;cachecontrol[filecache]&gt;=0.13.0&quot;
{
  conditions = [
    {
      op = &quot;&gt;=&quot;;
      version = {
        dev = null;
        epoch = 0;
        local = null;
        post = null;
        pre = null;
        release = [ 0 13 0 ];
      };
    }
  ];
  markers = null;
  name = &quot;cachecontrol&quot;;
  extras = [ &quot;filecache&quot; ];
  url = null;
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep508.mkEnviron"><a class="header" href="#function-library-lib.pep508.mkEnviron"><code>lib.pep508.mkEnviron</code></a></h2>
<p><strong>Type</strong>: <code>mkEnviron :: derivation -&gt; AttrSet</code></p>
<p>Create an attrset of platform variables.
As described in https://peps.python.org/pep-0508/#environment-markers.</p>
<p><code>python</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep508.mkEnviron}</p>
<h1 id="libpep508mkenviron-usage-example"><a class="header" href="#libpep508mkenviron-usage-example"><code>lib.pep508.mkEnviron</code> usage example</a></h1>
<pre><code class="language-nix"># mkEnviron pkgs.python3
{
  implementation_name = {
    type = &quot;string&quot;;
    value = &quot;cpython&quot;;
  };
  implementation_version = {
    type = &quot;version&quot;;
    value = {
      dev = null;
      epoch = 0;
      local = null;
      post = null;
      pre = null;
      release = [ 3 10 12 ];
    };
  };
  os_name = {
    type = &quot;string&quot;;
    value = &quot;posix&quot;;
  };
  platform_machine = {
    type = &quot;string&quot;;
    value = &quot;x86_64&quot;;
  };
  platform_python_implementation = {
    type = &quot;string&quot;;
    value = &quot;CPython&quot;;
  };
  # platform_release maps to platform.release() which returns
  # the running kernel version on Linux.
  # Because this field is not reproducible it's left empty.
  platform_release = {
    type = &quot;string&quot;;
    value = &quot;&quot;;
  };
  platform_system = {
    type = &quot;string&quot;;
    value = &quot;Linux&quot;;
  };
  # platform_version maps to platform.version() which also returns
  # the running kernel version on Linux.
  # Because this field is not reproducible it's left empty.
  platform_version = {
    type = &quot;version&quot;;
    value = {
      dev = null;
      epoch = 0;
      local = null;
      post = null;
      pre = null;
      release = [ ];
    };
  };
  python_full_version = {
    type = &quot;version&quot;;
    value = {
      dev = null;
      epoch = 0;
      local = null;
      post = null;
      pre = null;
      release = [ 3 10 12 ];
    };
  };
  python_version = {
    type = &quot;version&quot;;
    value = {
      dev = null;
      epoch = 0;
      local = null;
      post = null;
      pre = null;
      release = [ 3 10 ];
    };
  };
  sys_platform = {
    type = &quot;string&quot;;
    value = &quot;linux&quot;;
  };
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep508.evalMarkers"><a class="header" href="#function-library-lib.pep508.evalMarkers"><code>lib.pep508.evalMarkers</code></a></h2>
<p><strong>Type</strong>: <code>evalMarkers :: AttrSet -&gt; AttrSet -&gt; bool</code></p>
<p>Evaluate an environment as returned by <code>mkEnviron</code> against markers as returend by <code>parseMarkers</code>.</p>
<p><code>environ</code></p>
<p>: Function argument</p>
<p><code>value</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep508.evalMarkers}</p>
<h1 id="libpep508evalmarkers-usage-example"><a class="header" href="#libpep508evalmarkers-usage-example"><code>lib.pep508.evalMarkers</code> usage example</a></h1>
<pre><code class="language-nix"># evalMarkers (mkEnviron pkgs.python3) (parseMarkers &quot;python_version &lt; \&quot;3.11\&quot;&quot;)
true
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/pep508.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-pep518"><a class="header" href="#sec-functions-library-pep518">pep518</a></h1>
<h2 id="function-library-lib.pep518.parseBuildSystems"><a class="header" href="#function-library-lib.pep518.parseBuildSystems"><code>lib.pep518.parseBuildSystems</code></a></h2>
<p><strong>Type</strong>: <code>readPyproject :: AttrSet -&gt; list</code></p>
<p>Parse PEP-518 <code>build-system.requires</code> from pyproject.toml.</p>
<p><code>pyproject</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep518.parseBuildSystems}</p>
<h1 id="libpep518parsebuildsystems-usage-example"><a class="header" href="#libpep518parsebuildsystems-usage-example"><code>lib.pep518.parseBuildSystems</code> usage example</a></h1>
<pre><code class="language-nix"># parseBuildSystems (lib.importTOML ./pyproject.toml)
  [ ]  # List of parsed PEP-508 strings as returned by `lib.pep508.parseString`.
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/pep518.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-pep599"><a class="header" href="#sec-functions-library-pep599">pep599</a></h1>
<h2 id="function-library-lib.pep599.manyLinuxTargetMachines"><a class="header" href="#function-library-lib.pep599.manyLinuxTargetMachines"><code>lib.pep599.manyLinuxTargetMachines</code></a></h2>
<p>Map Nixpkgs CPU values to target machines known to be supported for manylinux* wheels (a.k.a. <code>uname -m</code>),
in nixpkgs found under the attribute <code>stdenv.targetPlatform.parsed.cpu.name</code></p>
<p>::: {.example #function-library-example-lib.pep599.manyLinuxTargetMachines}</p>
<h1 id="libpep599manylinuxtargetmachines-usage-example"><a class="header" href="#libpep599manylinuxtargetmachines-usage-example"><code>lib.pep599.manyLinuxTargetMachines</code> usage example</a></h1>
<pre><code class="language-nix"># legacyAliases.powerpc64
&quot;ppc64&quot;
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/pep599.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-pep600"><a class="header" href="#sec-functions-library-pep600">pep600</a></h1>
<h2 id="function-library-lib.pep600.legacyAliases"><a class="header" href="#function-library-lib.pep600.legacyAliases"><code>lib.pep600.legacyAliases</code></a></h2>
<p><strong>Type</strong>: <code>legacyAliases.${tag} :: AttrSet -&gt; string</code></p>
<p>Map legacy (pre PEP-600) platform tags to PEP-600 compliant ones.</p>
<p>https://peps.python.org/pep-0600/#legacy-manylinux-tags</p>
<p>::: {.example #function-library-example-lib.pep600.legacyAliases}</p>
<h1 id="libpep600legacyaliases-usage-example"><a class="header" href="#libpep600legacyaliases-usage-example"><code>lib.pep600.legacyAliases</code> usage example</a></h1>
<pre><code class="language-nix"># legacyAliases.&quot;manylinux1_x86_64&quot; or &quot;manylinux1_x86_64&quot;
&quot;manylinux_2_5_x86_64&quot;
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep600.manyLinuxTagCompatible"><a class="header" href="#function-library-lib.pep600.manyLinuxTagCompatible"><code>lib.pep600.manyLinuxTagCompatible</code></a></h2>
<p><strong>Type</strong>: <code>manyLinuxTagCompatible :: AttrSet -&gt; string -&gt; bool</code></p>
<p>Check if a manylinux tag is compatible with a given stdenv.</p>
<p><code>stdenv</code></p>
<p>: Function argument</p>
<p><code>tag</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep600.manyLinuxTagCompatible}</p>
<h1 id="libpep600manylinuxtagcompatible-usage-example"><a class="header" href="#libpep600manylinuxtagcompatible-usage-example"><code>lib.pep600.manyLinuxTagCompatible</code> usage example</a></h1>
<pre><code class="language-nix"># manyLinuxTagCompatible pkgs.stdenv &quot;manylinux_2_5_x86_64&quot;
true
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/pep600.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-pep621"><a class="header" href="#sec-functions-library-pep621">pep621</a></h1>
<h2 id="function-library-lib.pep621.parseDependencies"><a class="header" href="#function-library-lib.pep621.parseDependencies"><code>lib.pep621.parseDependencies</code></a></h2>
<p><strong>Type</strong>: <code>parseDependencies :: AttrSet -&gt; AttrSet</code></p>
<p>Parse dependencies from pyproject.toml.</p>
<p>structured function argument</p>
<p>: <code>pyproject</code></p>
<p>: Function argument</p>
<p><code>extrasAttrPaths</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep621.parseDependencies}</p>
<h1 id="libpep621parsedependencies-usage-example"><a class="header" href="#libpep621parsedependencies-usage-example"><code>lib.pep621.parseDependencies</code> usage example</a></h1>
<pre><code class="language-nix"># parseDependencies {
#
#   pyproject = (lib.importTOML ./pyproject.toml);
#   # Don't just look at `project.optional-dependencies` for groups, also look at these:
#   extrasAttrPaths = [ &quot;tool.pdm.dev-dependencies&quot; ];
# }
{
  dependencies = [ ];  # List of parsed PEP-508 strings (lib.pep508.parseString)
  extras = {
    dev = [ ];  # List of parsed PEP-508 strings (lib.pep508.parseString)
  };
  build-systems = [ ];  # PEP-518 build-systems (List of parsed PEP-508 strings)
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep621.parseRequiresPython"><a class="header" href="#function-library-lib.pep621.parseRequiresPython"><code>lib.pep621.parseRequiresPython</code></a></h2>
<p><strong>Type</strong>: <code>parseRequiresPython :: AttrSet -&gt; list</code></p>
<p>Parse project.python-requires from pyproject.toml</p>
<p><code>pyproject</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pep621.parseRequiresPython}</p>
<h1 id="libpep621parserequirespython-usage-example"><a class="header" href="#libpep621parserequirespython-usage-example"><code>lib.pep621.parseRequiresPython</code> usage example</a></h1>
<pre><code class="language-nix">#  parseRequiresPython (lib.importTOML ./pyproject.toml)
[ ]  # List of conditions as returned by `lib.pep440.parseVersionCond`
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep621.getDependenciesNames"><a class="header" href="#function-library-lib.pep621.getDependenciesNames"><code>lib.pep621.getDependenciesNames</code></a></h2>
<p><strong>Type</strong>: <code>getDependenciesNames :: AttrSet -&gt; AttrSet</code></p>
<p>Takes a dependency structure as returned by <code>lib.pep621.parseDependencies</code> and transforms it into
a structure with it's package names.</p>
<p>::: {.example #function-library-example-lib.pep621.getDependenciesNames}</p>
<h1 id="libpep621getdependenciesnames-usage-example"><a class="header" href="#libpep621getdependenciesnames-usage-example"><code>lib.pep621.getDependenciesNames</code> usage example</a></h1>
<pre><code class="language-nix"># getDependenciesNames (pep621.parseDependencies { pyproject = (lib.importTOML ./pyproject.toml); })
{
  dependencies = [ &quot;requests&quot; ];
  extras = {
    dev = [ &quot;pytest&quot; ];
  };
  build-systems = [ &quot;poetry-core&quot; ];
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep621.filterDependenciesByEnviron"><a class="header" href="#function-library-lib.pep621.filterDependenciesByEnviron"><code>lib.pep621.filterDependenciesByEnviron</code></a></h2>
<p><strong>Type</strong>: <code>filterDependenciesByEnviron :: AttrSet -&gt; AttrSet -&gt; AttrSet</code></p>
<p>Filter dependencies not relevant for this environment.</p>
<p><code>environ</code></p>
<p>: Environ as created by <code>lib.pep508.mkEnviron</code>.</p>
<p><code>extras</code></p>
<p>: Extras as a list of strings</p>
<p><code>dependencies</code></p>
<p>: Dependencies as parsed by <code>lib.pep621.parseDependencies</code>.</p>
<p>::: {.example #function-library-example-lib.pep621.filterDependenciesByEnviron}</p>
<h1 id="libpep621filterdependenciesbyenviron-usage-example"><a class="header" href="#libpep621filterdependenciesbyenviron-usage-example"><code>lib.pep621.filterDependenciesByEnviron</code> usage example</a></h1>
<pre><code class="language-nix"># filterDependenciesByEnviron (lib.pep508.mkEnviron pkgs.python3) (lib.pep621.parseDependencies (lib.importTOML ./pyproject.toml))
{ }  # Structure omitted in docs
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep621.filterDependenciesByExtras"><a class="header" href="#function-library-lib.pep621.filterDependenciesByExtras"><code>lib.pep621.filterDependenciesByExtras</code></a></h2>
<p><strong>Type</strong>: <code>filterDependenciesByExtras :: list[string] -&gt; AttrSet -&gt; AttrSet</code></p>
<p>Filter dependencies by their extras groups.</p>
<p><code>extras</code></p>
<p>: Extras groups as a list of strings.</p>
<p><code>dependencies</code></p>
<p>: Dependencies as parsed by <code>lib.pep621.parseDependencies</code>.</p>
<p>::: {.example #function-library-example-lib.pep621.filterDependenciesByExtras}</p>
<h1 id="libpep621filterdependenciesbyextras-usage-example"><a class="header" href="#libpep621filterdependenciesbyextras-usage-example"><code>lib.pep621.filterDependenciesByExtras</code> usage example</a></h1>
<pre><code class="language-nix"># filterDependenciesByExtras [ &quot;dev&quot; ] (lib.pep621.parseDependencies (lib.importTOML ./pyproject.toml))
{ }  # Structure omitted in docs
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pep621.filterDependencies"><a class="header" href="#function-library-lib.pep621.filterDependencies"><code>lib.pep621.filterDependencies</code></a></h2>
<p><strong>Type</strong>: <code>filterDependencies :: AttrSet -&gt; AttrSet</code></p>
<p>Aggregate of <code>filterDependencies</code> &amp; <code>filterDependenciesByExtras</code></p>
<p>structured function argument</p>
<p>: <code>dependencies</code></p>
<p>: Dependencies as parsed by <code>lib.pep621.parseDependencies</code></p>
<p><code>environ</code></p>
<p>: Environ as created by <code>lib.pep508.mkEnviron</code></p>
<p><code>extras</code></p>
<p>: Extras as a list of strings</p>
<p>::: {.example #function-library-example-lib.pep621.filterDependencies}</p>
<h1 id="libpep621filterdependencies-usage-example"><a class="header" href="#libpep621filterdependencies-usage-example"><code>lib.pep621.filterDependencies</code> usage example</a></h1>
<pre><code class="language-nix"># filterDependencies {
#   dependencies = lib.pep621.parseDependencies (lib.importTOML ./pyproject.toml);
#   environ = lib.pep508.mkEnviron pkgs.python;
#   extras = [ &quot;dev&quot; ];
# }
{ }  # Structure omitted in docs
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/pep621.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-poetry"><a class="header" href="#sec-functions-library-poetry">poetry</a></h1>
<h2 id="function-library-lib.poetry.translatePoetryProject"><a class="header" href="#function-library-lib.poetry.translatePoetryProject"><code>lib.poetry.translatePoetryProject</code></a></h2>
<p><strong>Type</strong>: <code>translatePoetryProject :: AttrSet -&gt; lambda</code></p>
<p>Translate a Pyproject.toml from Poetry to PEP-621 project metadata.
This function transposes a PEP-621 project table on top of an existing Pyproject.toml populated with data from <code>tool.poetry</code>.
Notably does not translate dependencies/optional-dependencies.</p>
<p>For parsing dependencies from Poetry see <code>lib.poetry.parseDependencies</code>.</p>
<p><code>pyproject</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.poetry.translatePoetryProject}</p>
<h1 id="libpoetrytranslatepoetryproject-usage-example"><a class="header" href="#libpoetrytranslatepoetryproject-usage-example"><code>lib.poetry.translatePoetryProject</code> usage example</a></h1>
<pre><code class="language-nix"># translatePoetryProject (lib.importTOML ./pyproject.toml)
{ }  # TOML contents, structure omitted. See PEP-621 for more information on data members.
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.poetry.parseDependencies"><a class="header" href="#function-library-lib.poetry.parseDependencies"><code>lib.poetry.parseDependencies</code></a></h2>
<p><strong>Type</strong>: <code>parseDependencies :: AttrSet -&gt; AttrSet</code></p>
<p>Parse dependencies from pyproject.toml (Poetry edition).
This function is analogous to <code>lib.pep621.parseDependencies</code>.</p>
<p><code>pyproject</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.poetry.parseDependencies}</p>
<h1 id="libpoetryparsedependencies-usage-example"><a class="header" href="#libpoetryparsedependencies-usage-example"><code>lib.poetry.parseDependencies</code> usage example</a></h1>
<pre><code class="language-nix"># parseDependencies {
#
#   pyproject = (lib.importTOML ./pyproject.toml);
# }
{
  dependencies = [ ];  # List of parsed PEP-508 strings (lib.pep508.parseString)
  extras = {
    dev = [ ];  # List of parsed PEP-508 strings (lib.pep508.parseString)
  };
  build-systems = [ ];  # PEP-518 build-systems (List of parsed PEP-508 strings)
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.poetry.parseVersionCond"><a class="header" href="#function-library-lib.poetry.parseVersionCond"><code>lib.poetry.parseVersionCond</code></a></h2>
<p><strong>Type</strong>: <code>parseVersionCond :: string -&gt; [ AttrSet ]</code></p>
<p>Parse a version conditional.
Supports additional non-standard operators <code>^</code> and <code>~</code> used by Poetry.</p>
<p>Because some expressions desugar to multiple expressions parseVersionCond returns a list.</p>
<p><code>cond</code></p>
<p>: Function argument</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/poetry.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-pypa"><a class="header" href="#sec-functions-library-pypa">pypa</a></h1>
<h2 id="function-library-lib.pypa.normalizePackageName"><a class="header" href="#function-library-lib.pypa.normalizePackageName"><code>lib.pypa.normalizePackageName</code></a></h2>
<p><strong>Type</strong>: <code>normalizePackageName :: string -&gt; string</code></p>
<p>Normalize package name as documented in https://packaging.python.org/en/latest/specifications/name-normalization/#normalization</p>
<p>::: {.example #function-library-example-lib.pypa.normalizePackageName}</p>
<h1 id="libpypanormalizepackagename-usage-example"><a class="header" href="#libpypanormalizepackagename-usage-example"><code>lib.pypa.normalizePackageName</code> usage example</a></h1>
<pre><code class="language-nix"># readPyproject &quot;Friendly-Bard&quot;
&quot;friendly-bard&quot;
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pypa.parsePythonTag"><a class="header" href="#function-library-lib.pypa.parsePythonTag"><code>lib.pypa.parsePythonTag</code></a></h2>
<p><strong>Type</strong>: <code>parsePythonTag :: string -&gt; AttrSet</code></p>
<p>Parse Python tags.</p>
<p>As described in https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/#python-tag.</p>
<p><code>tag</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pypa.parsePythonTag}</p>
<h1 id="libpypaparsepythontag-usage-example"><a class="header" href="#libpypaparsepythontag-usage-example"><code>lib.pypa.parsePythonTag</code> usage example</a></h1>
<pre><code class="language-nix"># parseABITag &quot;cp37dmu&quot;
{
  implementation = &quot;cp&quot;;
  version = &quot;37&quot;;
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pypa.parseABITag"><a class="header" href="#function-library-lib.pypa.parseABITag"><code>lib.pypa.parseABITag</code></a></h2>
<p><strong>Type</strong>: <code>parseABITag :: string -&gt; AttrSet</code></p>
<p>Parse ABI tags.</p>
<p>As described in https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/#python-tag.</p>
<p><code>tag</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pypa.parseABITag}</p>
<h1 id="libpypaparseabitag-usage-example"><a class="header" href="#libpypaparseabitag-usage-example"><code>lib.pypa.parseABITag</code> usage example</a></h1>
<pre><code class="language-nix"># parseABITag &quot;cp37dmu&quot;
{
  flags = [ &quot;d&quot; &quot;m&quot; &quot;u&quot; ];
  implementation = &quot;cp&quot;;
  version = &quot;37&quot;;
}
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pypa.isWheelFileName"><a class="header" href="#function-library-lib.pypa.isWheelFileName"><code>lib.pypa.isWheelFileName</code></a></h2>
<p><strong>Type</strong>: <code>isWheelFileName :: string -&gt; bool</code></p>
<p>Check whether string is a wheel file or not.</p>
<p><code>name</code></p>
<p>: Function argument</p>
<p>::: {.example #function-library-example-lib.pypa.isWheelFileName}</p>
<h1 id="libpypaiswheelfilename-usage-example"><a class="header" href="#libpypaiswheelfilename-usage-example"><code>lib.pypa.isWheelFileName</code> usage example</a></h1>
<pre><code class="language-nix"># isWheelFileName &quot;cryptography-41.0.1-cp37-abi3-manylinux_2_17_aarch64.manylinux2014_aarch64.whl&quot;
true
</code></pre>
<p>:::</p>
<h2 id="function-library-lib.pypa.parseWheelFileName"><a class="header" href="#function-library-lib.pypa.parseWheelFileName"><code>lib.pypa.parseWheelFileName</code></a></h2>
<p><strong>Type</strong>: <code>parseFileName :: string -&gt; AttrSet</code></p>
<p>Parse PEP-427 wheel file names.</p>
<p><code>name</code></p>
<p>: The wheel filename is <code>{distribution}-{version}(-{build tag})?-{python tag}-{abi tag}-{platform tag}.whl</code>.</p>
<p>::: {.example #function-library-example-lib.pypa.parseWheelFileName}</p>
<h1 id="libpypaparsewheelfilename-usage-example"><a class="header" href="#libpypaparsewheelfilename-usage-example"><code>lib.pypa.parseWheelFileName</code> usage example</a></h1>
<pre><code class="language-nix"># parseFileName &quot;cryptography-41.0.1-cp37-abi3-manylinux_2_17_aarch64.manylinux2014_aarch64.whl&quot;
 {
  abiTag = {
    implementation = &quot;abi&quot;;
    version = &quot;3&quot;;
    flags = [ ];
  };
  buildTag = null;
  distribution = &quot;cryptography&quot;;
  languageTags = [  # Parsed by pypa.parsePythonTag
    {
      implementation = &quot;cpython&quot;;
      version = &quot;37&quot;;
    }
  ];
  platformTags = [ &quot;manylinux_2_17_aarch64&quot; &quot;manylinux2014_aarch64&quot; ];
  version = &quot;41.0.1&quot;;
}
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/pypa.nix">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="sec-functions-library-pip"><a class="header" href="#sec-functions-library-pip">pip</a></h1>
<h2 id="function-library-lib.pip.parseRequirementsTxt"><a class="header" href="#function-library-lib.pip.parseRequirementsTxt"><code>lib.pip.parseRequirementsTxt</code></a></h2>
<p><strong>Type</strong>: <code>parseRequirementsTxt :: AttrSet -&gt; list</code></p>
<p>Parse dependencies from requirements.txt</p>
<p><code>requirements</code></p>
<p>: The contents of or path to requirements.txt</p>
<p>::: {.example #function-library-example-lib.pip.parseRequirementsTxt}</p>
<h1 id="libpipparserequirementstxt-usage-example"><a class="header" href="#libpipparserequirementstxt-usage-example"><code>lib.pip.parseRequirementsTxt</code> usage example</a></h1>
<pre><code class="language-nix"># parseRequirements ./requirements.txt
[ { flags = []; requirement = {}; # Returned by pep508.parseString } ]
</code></pre>
<p>:::</p>
<footer id="open-on-gh">Found an issue? <a href="https://github.com/nix-community/pyproject.nix/edit/master/lib/pip.nix">Edit this page on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
